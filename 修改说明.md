# 功能实现详细说明

### 1. 权限控制系统

#### 1.1 路由层面权限控制
```javascript
// 修改前：只有管理员能访问
meta: { requiresAuth: true, role: '管理员' }

// 修改后：员工和管理员都能访问
meta: { requiresAuth: true }
```

#### 1.2 页面层面功能控制
```javascript
// 管理员专用功能
v-if="userProfile.role === '管理员'"

// 权限检查函数
setActiveTab(tab) {
  if ((tab === 'dashboard' || tab === 'employees') && this.userProfile.role !== '管理员') {
    return // 员工无法访问管理功能
  }
}
```

### 2. 个人信息展示（通用功能）

#### 2.1 顶部用户信息栏
- **头像**：显示用户姓名首字母，圆形背景
- **工号**：显示account字段
- **姓名**：显示name字段  
- **权限**：显示role字段（员工/管理员）

#### 2.2 实现代码
```vue
<div class="user-info">
  <div class="avatar">{{ userProfile.name ? userProfile.name.charAt(0) : 'A' }}</div>
  <div class="user-details">
    <h3>{{ userProfile.name }}</h3>
    <p>工号：{{ userProfile.account }} | 权限：{{ userProfile.role }}</p>
  </div>
</div>
```

### 3. 打卡功能（通用功能）

#### 3.1 功能特点
- **实时时间显示**：每秒更新当前时间和日期
- **上班打卡**：自动判断是否迟到（基准时间9:00）
- **下班打卡**：自动判断是否早退（基准时间18:00）
-  **打卡反馈**：显示打卡结果消息

#### 3.2 业务逻辑
```javascript
// 上班打卡逻辑
if (current_time.hour > 9 || (current_time.hour == 9 && current_time.minute > 0)):
    status = '迟到'
else:
    status = '正常'

// 下班打卡逻辑  
if (current_time.hour < 18):
    status = '早退'
```

### 4. 查看个人考勤（通用功能）

#### 4.1 本月考勤统计卡片
- **应出勤天数**：22天（固定值）
- **实际出勤天数**：当月实际打卡天数
- **迟到次数**：状态为"迟到"的记录数
- **早退次数**：状态为"早退"的记录数
- **正常次数**：状态为"正常"的记录数

#### 4.2 最近考勤记录表格
- 显示最近10条考勤记录
- 包含：日期、上班时间、下班时间、状态
- 状态颜色区分（正常-绿色，迟到-红色，早退-橙色）

### 5. 查看所有人考勤记录总体情况（管理员专用）

#### 5.1 当天考勤总体统计
```javascript
// API: GET /admin/attendance/daily
{
  "date": "2025-09-29",
  "should_attend": 5,      // 总员工数
  "actual_attendance": 3,   // 实际出勤人数
  "late_count": 1,         // 迟到人数
  "early_leave_count": 0,  // 早退人数  
  "normal_count": 2        // 正常人数
}
```

#### 5.2 每个员工本日、本月考勤情况
-  **员工列表**：显示所有员工基本信息
- **今日出勤状态**：已出勤/未出勤
- **本月统计**：出勤天数、迟到次数、早退次数、正常次数

#### 5.3 多维度排序功能
```javascript
// 支持的排序方式
sortBy: ['name', 'late_count', 'early_leave_count', 'normal_count']
sortOrder: ['asc', 'desc']

// Python后端排序实现
if sort_by == 'late_count':
    employees_list.sort(key=lambda x: x['monthly_stats']['late_count'], 
                       reverse=(sort_order == 'desc'))
```

### 后端API接口

####  权限验证
```python
@jwt_required()
def get_daily_attendance_overview():
    current_user_id = int(get_jwt_identity())
    user = User.query.get(current_user_id)
    
    # 检查管理员权限
    if not user or user.role != '管理员':
        return jsonify({'message': 'Access denied. Admin role required.'}), 403
```

#### 数据库查询优化
```python

late_count = db.session.query(func.count(Attendance.attendance_id)).filter(
    and_(
        func.date(Attendance.clock_in_time) == today,
        Attendance.status == '迟到'
    )
).scalar() or 0
```
